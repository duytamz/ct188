<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" href="css.css" />
  </head>

  <script
    type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
  ></script>

  <body>
    <h1 class="text-center py-4">CÁC ĐỊA ĐIỂM YÊU THÍCH</h1>
    <hr>
    <div
      id="main"
      class="container row justify-content-center text-center"
    ></div>
  </body>

  <script>
    $(document).ready(function () {
      // Lấy id từ URL
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get("id");
      const delete_id = urlParams.get("delete_id");
      // Kiểm tra xem id có tồn tại và không trống
      if (id) {
        // Lấy danh sách ID từ localStorage (nếu có)
        let favoriteIds = JSON.parse(localStorage.getItem("favoriteIds")) || [];
        
        if (!favoriteIds.includes(id)) {
          favoriteIds.push(id);
          // Lưu lại danh sách ID mới vào localStorage
          localStorage.setItem("favoriteIds", JSON.stringify(favoriteIds));
          alert("Thêm địa điểm yêu thích thành công");
        }
      }
      if (delete_id) {
        let favoriteIds = JSON.parse(localStorage.getItem("favoriteIds")) || [];

        if (favoriteIds.includes(delete_id)) {
          favoriteIds.splice(favoriteIds.indexOf(delete_id), 1);
          localStorage.setItem("favoriteIds", JSON.stringify(favoriteIds));
          alert("Xóa 1 địa điểm khỏi yêu thích thành công");
        }
      }
      // Lấy danh sách ID từ localStorage (nếu có)
      let favoriteIds = JSON.parse(localStorage.getItem("favoriteIds")) || [];

      let globalData; // Đặt tên biến toàn cục khác để tránh xung đột

      fetch("data.json")
        .then((response) => response.json())
        .then((jsonData) => {
          let tbody = $("#main");

          globalData = jsonData;

          globalData.forEach((place) => {
            if (favoriteIds.includes(place.id)) {
              let tr = $("<div>").addClass("col-3 px-2");

            let tr_con = $("<div>").addClass("border border-1 product");

            let img = $("<img>").addClass("img-fluid w-100 ");
            img.attr("src", place.image);
            img.attr("alt", "Ảnh địa điểm");
            tr_con.append(img);

            let content = $('<div>').addClass("content");

            let td_destination = $("<h3>");
            td_destination.text(place.destination);
            content.append(td_destination);

            let td_description = $("<p>");
            td_description.text(place.description);
            content.append(td_description);

            let id = place.id;

            let td_favorite_btn = $(`<a href="yeuthich.html?delete_id=${id}">`);
            td_favorite_btn.html('<i class="fa-solid fa-trash fa-lg"></i>');
            content.append(td_favorite_btn);


            tr_con.append(content);
            tr.append(tr_con); 

            tbody.append(tr);
            }
          });
        });

      function xoaLocal() {
        localStorage.clear();
      }
    });
  </script>
</html>
